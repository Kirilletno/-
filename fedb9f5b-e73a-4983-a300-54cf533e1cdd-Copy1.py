#!/usr/bin/env python
# coding: utf-8

# <div style="border:solid green 2px; padding: 20px">
# <b>–ö–∏—Ä–∏–ª–ª, –ø—Ä–∏–≤–µ—Ç!</b>
# 
# –ú–µ–Ω—è –∑–æ–≤—É—Ç –ê–Ω–¥—Ä–µ–µ–≤–∞ –Æ–ª–∏—è, —è –±—É–¥—É —Ä–µ–≤—å—é–µ—Ä–æ–º –Ω–∞ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ.
# 
# –¢–≤–æ–π –ø—Ä–æ–µ–∫—Ç –ª–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å –∏ –ø–æ –Ω–µ–º—É —É–¥–æ–±–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è ‚Äî –µ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –ø–æ—è—Å–Ω–µ–Ω–∏—è, –ø–µ—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–æ–¥–µ–ª–µ–π –∏ –≤—ã–≤–æ–¥—ã. –ü–æ—á—Ç–∏ –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —ç—Ç–∞–ø—ã –≤ —Ä–∞–±–æ—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.
# 
# –ï—Å—Ç—å –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç—å. –û–Ω–∏ –∫–∞—Å–∞—é—Ç—Å—è –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏, –º–µ—Ç–æ–¥–æ–≤ –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º. –í—Å—ë —ç—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–µ–π –æ–ø–∏—Å–∞–Ω–æ –ø–æ —Ö–æ–¥—É —Ä–∞–±–æ—Ç—ã –∏ –¥–∞–Ω–æ –æ–±—â–∏–º —Å–ø–∏—Å–∫–æ–º –≤ –∏—Ç–æ–≥–æ–≤–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.
#     
# –Ø –±—É–¥—É –æ—Ñ–æ—Ä–º–ª—è—Ç—å —Å–≤–æ–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
# 
# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå:</b> –¢–∞–∫ –≤—ã–¥–µ–ª–µ–Ω—ã –≤–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è. –ë–µ–∑ –∏—Ö –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç –Ω–µ –±—É–¥–µ—Ç –ø—Ä–∏–Ω—è—Ç. </div>
# 
# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ö†Ô∏è:</b> –¢–∞–∫ –≤—ã–¥–µ–ª–µ–Ω—ã –Ω–µ–±–æ–ª—å—à–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è. –ò—Ö –º–æ–∂–Ω–æ —É—á–µ—Å—Ç—å –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –±—É–¥—É—â–∏—Ö –∑–∞–¥–∞–Ω–∏–π –∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ–µ–∫—Ç —Å–µ–π—á–∞—Å (–æ–¥–Ω–∞–∫–æ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).</div>
# 
# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è:</b> –¢–∞–∫ —è –≤—ã–¥–µ–ª—è—é –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.</div>
#     
# –ü—Ä–∏–º–µ—Ä –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–ª—è —Ç–≤–æ–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:
# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–æ—Ç —Ç–∞–∫.</div>
#     
# –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å –∫–∞–∫–∏–µ-—Ç–æ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –ø—Ä–æ–µ–∫—Ç—É ‚Äî –∑–∞–¥–∞–≤–∞–π, —è –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –≤—Å—ë —Ä–∞–∑—ä—è—Å–Ω–∏—Ç—å üòâ

# <h1>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ<span class="tocSkip"></span></h1>
# <div class="toc"><ul class="toc-item"><li><span><a href="#–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–¥–∞–Ω–Ω—ã—Ö" data-toc-modified-id="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–¥–∞–Ω–Ω—ã—Ö-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö</a></span></li><li><span><a href="#–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ-–∑–∞–¥–∞—á–∏" data-toc-modified-id="–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ-–∑–∞–¥–∞—á–∏-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</a></span></li><li><span><a href="#–ë–æ—Ä—å–±–∞-—Å-–¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º" data-toc-modified-id="–ë–æ—Ä—å–±–∞-—Å-–¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>–ë–æ—Ä—å–±–∞ —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º</a></span></li><li><span><a href="#–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–º–æ–¥–µ–ª–∏" data-toc-modified-id="–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–º–æ–¥–µ–ª–∏-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏</a></span></li><li><span><a href="#–ß–µ–∫-–ª–∏—Å—Ç-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏-–ø—Ä–æ–µ–∫—Ç–∞" data-toc-modified-id="–ß–µ–∫-–ª–∏—Å—Ç-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏-–ø—Ä–æ–µ–∫—Ç–∞-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>–ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞</a></span></li></ul></div>

# # –û—Ç—Ç–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤

# –ò–∑ ¬´–ë–µ—Ç–∞-–ë–∞–Ω–∫–∞¬ª —Å—Ç–∞–ª–∏ —É—Ö–æ–¥–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—ã. –ö–∞–∂–¥—ã–π –º–µ—Å—è—Ü. –ù–µ–º–Ω–æ–≥–æ, –Ω–æ –∑–∞–º–µ—Ç–Ω–æ. –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∏ –ø–æ—Å—á–∏—Ç–∞–ª–∏: —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–µ–∫—É—â–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–µ—à–µ–≤–ª–µ, —á–µ–º –ø—Ä–∏–≤–ª–µ–∫–∞—Ç—å –Ω–æ–≤—ã—Ö.
# 
# –ù—É–∂–Ω–æ —Å–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å, —É–π–¥—ë—Ç –∫–ª–∏–µ–Ω—Ç –∏–∑ –±–∞–Ω–∫–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –∏–ª–∏ –Ω–µ—Ç. –í–∞–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ —Å –±–∞–Ω–∫–æ–º. 
# 
# –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –º–æ–¥–µ–ª—å —Å –ø—Ä–µ–¥–µ–ª—å–Ω–æ –±–æ–ª—å—à–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º *F1*-–º–µ—Ä—ã. –ß—Ç–æ–±—ã —Å–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ, –Ω—É–∂–Ω–æ –¥–æ–≤–µ—Å—Ç–∏ –º–µ—Ç—Ä–∏–∫—É –¥–æ 0.59. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ *F1*-–º–µ—Ä—É –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.
# 
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ—Ä—è–π—Ç–µ *AUC-ROC*, —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –µ—ë –∑–Ω–∞—á–µ–Ω–∏–µ —Å *F1*-–º–µ—Ä–æ–π.
# 
# –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: [https://www.kaggle.com/barelydedicated/bank-customer-churn-modeling](https://www.kaggle.com/barelydedicated/bank-customer-churn-modeling)

# ## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –Ω–∞–º –≤ —Ö–æ–¥–µ —Ä–∞–±–æ—Ç—ã

# In[2]:


import pandas as pd
import numpy as np

from sklearn.model_selection import train_test_split 
from sklearn.utils import shuffle

from sklearn.linear_model import LogisticRegression
from sklearn.tree import DecisionTreeClassifier
from sklearn.ensemble import RandomForestClassifier

from sklearn.metrics import f1_score
from sklearn.metrics import roc_auc_score

from sklearn.preprocessing import StandardScaler 
from sklearn.preprocessing import OneHotEncoder


# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ö†Ô∏è:</b> –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ç–æ, —á—Ç–æ–±—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ —Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –ø–∞–∫–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ (OrdinalEncoder –ª–∏—à–Ω–∏–π). –ò–Ω–æ–≥–¥–∞ –∏–º–ø–æ—Ä—Ç –ª–∏—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –±–æ–ª—å—à–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–º –∑–∞—Ç—Ä–∞—Ç–∞–º –∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–∞–º—è—Ç–∏.

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –°–ø–∞—Å–∏–±–æ, –∏—Å–ø—Ä–∞–≤–∏–ª, –Ω–µ –∑–Ω–∞–ª –æ–± —ç—Ç–æ–º. </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è:</b> üëçüòâ
# </div>

# –ò–∑—É—á–∞–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

# In[3]:


df = pd.read_csv('/datasets/Churn.csv')
df.info()
df.head()


# –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤ –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–æ–º OHE, –∞ —Ç–∞–∫–∂–µ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–ø—É—Å–∫–∏ –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã, –≤–æ –∏–∑–±–µ–∂–∞–Ω–≥–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏- ValueError: Input contains NaN, infinity or a value too large for dtype('float64'). –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º, –ø—Ä–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–¥–µ–ª–∏ (–ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –∏–∑-–∑–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ —Å—Ç–æ–ª–±—Ü–µ Tenure)
# 
# –¢–∞–∫–∂–µ, —á—Ç–æ–±—ã –Ω–µ –ø–ª–æ–¥–∏—Ç—å –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–∏, –ø–æ—Å–ª–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ, —É–¥–∞–ª—è–µ–º —Å—Ç–æ–ª–±–µ—Ü- Surname

# df = df.drop('Surname', axis=1)
# df_ohe = pd.get_dummies(df, drop_first=True)
# df_ohe = df_ohe.replace((np.inf, np.nan), 0).reset_index(drop=True)

# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå:</b> –£–¥–∞–ª–µ–Ω—ã –Ω–µ –≤—Å–µ –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏.
#     
# –¢–∞–∫–∂–µ —Ö–æ—á—É –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç. –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –Ω—É–∂–Ω–æ –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –≤—ã–±–æ—Ä–∫–∏. –ü—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π –º—ã –ø—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å–æ–∑–¥–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –∏–º–µ–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è + –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞), –∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏ –Ω–µ—Ç, —Ç.–∫. —ç—Ç–æ ¬´–¥–∞–Ω–Ω—ã–µ –∏–∑ –±—É–¥—É—â–µ–≥–æ¬ª. –ü–æ—ç—Ç–æ–º—É –º—ã –∑–Ω–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–∞–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å—Ç—å –≤ –Ω–∞—à–∏—Ö —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–≤ <i>geography</i> —ç—Ç–æ France, Spain, Germany, –∞ –≤ <i>gender</i> ‚Äî Male, Female). –ê –≤ ¬´–±—É–¥—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö¬ª –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–∞–Ω–µ–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ –±—ã–ª–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –µ—â–µ –æ–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ Italy –≤ —Å—Ç–æ–ª–±—Ü–µ <i>geography</i>). –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ <code>get_dummies</code> —É–∂–µ –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è, –ø–æ—è–≤–∏—Ç—Å—è –æ—à–∏–±–∫–∞. –ê <code>OneHotEncoder()</code> —Å —Ç–∞–∫–∏–º–∏ —Å–∏—Ç—É–∞—Ü–∏—è–º–∏ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.
#     
# –í –¥–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã, —á—Ç–æ –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π, —á—Ç–æ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ, –ø–æ—ç—Ç–æ–º—É —Ç—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å get_dummies, –Ω–æ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –≤—ã–±–æ—Ä–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≤—ã–±–æ—Ä–∫–∏. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏—Å—å –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ñ–∏—á–∏ –≤ –∫–∞–∂–¥–æ–π –≤—ã–±–æ—Ä–∫–µ (—Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ —Å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏).
# </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è:</b> –ü—Ä–∞–≤–∏–ª—å–Ω–æ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –∞—Ä–≥—É–º–µ–Ω—Ç drop_first=True ‚Äî –ø–æ—Å–ª–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö. –í —Ç–µ—Ö–Ω–∏–∫–µ OHE –µ–≥–æ —Ç–∞–∫–∂–µ –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.
# </div>

# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ö†Ô∏è:</b> –í –±—É–¥—É—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –±—É–¥–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è fit OHE —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ (–∏ transform –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤—ã–±–æ—Ä–∫–∏). –¢—ã –º–æ–∂–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Å–µ–π—á–∞—Å. –í —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ø—Ä–∏–Ω—Ç–∞—Ö —ç—Ç–æ —É–∂–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ.
#     
# get_dummies –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –∞ –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –±–æ–ª–µ–µ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª–µ–Ω OHE, —Ç.–∫. –æ–Ω –ø–æ–∑–æ–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å —Ä—è–¥ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π (–æ–¥–Ω—É –∏–∑ –Ω–∏—Ö —è –æ–ø–∏—Å–∞–ª–∞ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤—ã—à–µ).
#     
# –°–∫–∏–¥—ã–≤–∞—é —Å—Ç–∞—Ç—å—é —Å –Ω–∞–≥–ª—è–¥–Ω—ã–º –ø—Ä–∏–º–µ—Ä–æ–º –æ —Ä–∞–∑–Ω–∏—Ü–µ OneHotEncoder() vs get_dummies:
# https://albertum.medium.com/preprocessing-onehotencoder-vs-pandas-get-dummies-3de1f3d77dcc
#     
# –ü—Ä–æ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É Ordinal Encoding –∏ One-Hot-Encoding: https://stackoverflow.com/questions/69052776/ordinal-encoding-or-one-hot-encoding
#     
# –ü–æ—á–µ–º—É –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å OHE –ø–æ—Å–ª–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –≤—ã–±–æ—Ä–∫–∏ —Å –ø—Ä–∏–º–µ—Ä–æ–º: https://stackoverflow.com/questions/55525195/do-i-have-to-do-one-hot-encoding-separately-for-train-and-test-dataset
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –ü–æ–Ω—è–ª, –±–ª–∞–≥–æ–¥–∞—Ä—é. –í–Ω–µ—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∏–∂–µ + –¥–æ–±–∞–≤–ª—é, –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤—ã–≤–æ–¥ –æ—Ç–º–µ–Ω–∏–ª.
# –£–¥–∞–ª—è–µ–º –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏: Surname, RowNumber, CustomerId. + –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–ø—É—Å–∫–∏ –≤ —Å—Ç–æ–ª–±—Ü–µ Tenure –∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–ø—É—Å–∫–∞—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞ –Ω–∞ –Ω–æ–ª—å </div> 

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è:</b> –•–æ—Ä–æ—à–æ!
# </div>

# In[4]:


df = df.drop(['Surname', 'CustomerId', 'RowNumber'], axis=1)
df = df.replace((np.inf, np.nan), 0).reset_index(drop=True)


# –í–û–ü–†–û–° –†–ï–í–¨–Æ–≠–†–£- –ø—Ä–æ–ø—É—Å–∫–∏ –∏ –±–µ—Å–æ–Ω–µ—á–Ω–æ—Å—Ç–∏ –≤ –∏—Ç–æ–≥–µ, –±—ã–ª–æ —Ä–µ—à–µ–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –Ω—É–¥–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º, –∞ –Ω–µ –º–µ–¥–∏–∞–Ω–æ–π, —á—Ç–æ–±—ã –Ω–µ –∏—Å–∫–∞–∂–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ç–∞–∫ –∫–∞–∫ –º—ã –Ω–µ –∑–Ω–∞–µ–º –ø—Ä–∏—á–∏–Ω –ø—Ä–æ–ø—É—Å–∫–æ–≤, –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –≤–µ—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ?

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è:</b> –ß—Ç–æ–±—ã –Ω–µ –∏—Å–∫–∞–∂–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–ø—É—Å–∫–∏ –∑–∞–º–µ–Ω—è—é—Ç –Ω–∞ –º–µ–¥–∏–∞–Ω—É. –ò–ª–∏ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∑–∞–º–µ–Ω—É –Ω–∞ –¥—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∞—Ä–≥—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–≤ —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ 0 –≤ tenure –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å, —á—Ç–æ —á–µ–ª–æ–≤–µ–∫ –±—ã–ª –∫–ª–∏–µ–Ω—Ç–æ–º –±–∞–Ω–∫–∞ –º–µ–Ω—å—à–µ –≥–æ–¥–∞, –ø–æ—ç—Ç–æ–º—É —Ç–∞–∫–∞—è –∑–∞–º–µ–Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º–∞.
# </div>

# –í—ã–¥–µ–ª—è–µ–º —Ü–µ–ª–µ–≤–æ–π –ø—Ä–∏–∑–Ω–∞–∫, –∞ —Ç–∞–∫–∂–µ –¥–µ–ª–∏–º –≤—ã–±–æ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—É—é, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Ä–∞–±–æ—Ç—ã 

# target = df['Exited']
# features = df.drop('Exited', axis=1)
# 
# features_train, features_test1, target_train, target_test1 = train_test_split(
#     features, target, test_size=0.4, random_state=12345)
# features_valid, features_test,target_valid, target_test = train_test_split(
#     features_test1, target_test1, test_size=0.5, random_state=12345)
# 
# display(features_train.dtypes)

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è:</b> –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–æ–∫ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ. –•–æ—Ä–æ—à–æ, —á—Ç–æ –Ω–µ –∑–∞–±—ã–≤–∞–µ—à—å —É–∫–∞–∑—ã–≤–∞—Ç—å <code>random_state</code> ‚Äî —ç—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ç–∞–∫–æ–µ –∂–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –≤—ã–±–æ—Ä–∫–∏.
# </div>

# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ö†Ô∏è:</b> –ü—Ä–∏ –¥–µ–ª–µ–Ω–∏–∏ –Ω–∞ –≤—ã–±–æ—Ä–∫–∏ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä stratify, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –º–µ—Ç—Ä–∏–∫–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø—Å–µ–≤–¥–æ—Å–ª—É—á–∞–π–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç random_state, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ç—Ä–µ–π–Ω –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –º–∞–ª–æ –∑–Ω–∞—á–µ–Ω–∏–π –∫–ª–∞—Å—Å–∞ 1, –æ—Ç—Å—é–¥–∞ –Ω–∏–∑–∫–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ –Ω–∞ –¥—Ä—É–≥–∏—Ö –≤—ã–±–æ—Ä–∫–∞—Ö).
#     
# –¢–∞–∫–∂–µ —Å—Ç–æ–∏—Ç –ø–µ—á–∞—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏–≤—à–∏—Ö—Å—è –≤—ã–±–æ—Ä–æ–∫ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ –∏ —ç—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –≤–æ–≤—Ä–µ–º—è –∑–∞–º–µ—Ç–∏—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏.
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –°–ø–∞—Å–∏–±–æ, –∑–∞–∫–æ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤—ã–≤–æ–¥, –ø—Ä–∏–∫—Ä–µ–ø–ª—è—é –Ω–∏–∂–µ –≤–µ—Ä–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å —É—á–µ—Ç–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ stratify –∏ –≤—ã–≤–æ–¥–æ–º –ø–æ–¥—Å—á–µ—Ç–∞ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –∫–∞–∂–¥–æ–π –≤—ã–±–æ—Ä–∫–µ. </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è:</b> –û—Ç–ª–∏—á–Ω–æ!
# </div>

# In[5]:


target = df['Exited']
features = df.drop('Exited', axis=1)

features_train, features_test1, target_train, target_test1 = train_test_split(
    features, target, test_size=0.4, random_state=12345,  stratify= target)
features_valid, features_test,target_valid, target_test = train_test_split(
    features_test1, target_test1, test_size=0.5, random_state=12345, stratify= target_test1)

print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ target_train –ø–æ –∫–ª–∞—Å—Å–∞–º: {np.bincount(target_train)}")
print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ target_valid –ø–æ –∫–ª–∞—Å—Å–∞–º: {np.bincount(target_valid)}")
print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ target_test –ø–æ –∫–ª–∞—Å—Å–∞–º: {np.bincount(target_test)}")


# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –¢–∞–∫–∂–µ, –ø—Ä–æ–≤–æ–∂—É —Ä–∞–∑–¥–µ–ª—å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –≤—ã–±–æ—Ä–∫–∏ —Å –ø–æ–º–æ—â—å—é OHE, –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π –≤—ã–±–æ—Ä–∫–∏, –ø–æ—Å–ª–µ –∏—Ö —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.
#     
# P.S. –ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª, –∫–∞–∫ –≤ –∏—Ç–æ–≥–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é —Ç–µ—Ö–Ω–∏–∫–∏ OHE, –≤–º–µ—Å—Ç–æ pd.get dummies, –Ω–∞—à–µ–ª —Ç–æ–ª—å–∫–æ —Ç–∞–∫—É—é —Å—Ç–∞—Ç—å—é- https://www.codecamp.ru/blog/one-hot-encoding-in-python/ –ù–æ –∫–∞–∂–µ—Ç—Å—è —á—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª–µ–µ –ª–µ–≥–∫–∏–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–æ–¥–∏—Ç—å –µ–≥–æ, –∏–ª–∏ —Ç—É—Ç –æ–ø–∏—Å–∞–Ω –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ—Ä–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º? –ù–∞—Å–∫–æ–ª—å–∫–æ —è –ø–æ–Ω—è–ª, OHE —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ –∏ –ø–æ–∫–∞ –º–Ω–µ –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ —ç—Ç–æ –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏   

# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚ö†Ô∏è: </b> –î–∞, –≤ —Å—Ç–∞—Ç—å–µ –ø–æ–∫–∞–∑–∞–Ω –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –î–ª—è OHE –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ preprocessing –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã <code>handle_unknown</code> –∏ <code>drop='first'</code>. –ü–µ—Ä–≤—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–æ, –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–∞–Ω–µ–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω —Ä–∞–≤–µ–Ω 'error' ‚Äî –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è transform –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è (–∫–∞–∫ –∏ –ø—Ä–∏ get_dummies). –ê –µ—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä —Ä–∞–≤–Ω—ã–º 'ignore', —Ç–æ–≥–¥–∞ –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –≤ —Å—Ç–æ–ª–±—Ü–∞—Ö —Å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–º–µ—é—â–∏–º–∏—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –±—É–¥—É—Ç —Å—Ç–æ—è—Ç—å –Ω—É–ª–∏. 
#     
# –î–∞–ª–µ–µ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ä–∞–∑–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏. –û–¥–∏–Ω –∏–∑ –Ω–∏—Ö ‚Äî –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —ç–Ω–∫–æ–¥–µ—Ä–∞ –∏ fit, –≤ –∫–æ–Ω—Ü–µ –µ—â—ë –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å toarray() <code>encoder.fit_transform(features_train[names]).toarray()</code>, —á—Ç–æ–±—ã –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –æ—Ç–æ–±—Ä–∞–∑–∏–ª–∞—Å—å –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–æ–≤ –∏ –º–æ–∂–Ω–æ –±—ã–ª–æ –∏–∑ –Ω–∏—Ö —Å–æ–∑–¥–∞—Ç—å –¥–∞—Ç–∞—Ñ—Ä–µ–π–º. –ò –∑–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–π –≤—ã–±–æ—Ä–∫–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–µ–¥–∏–Ω–∏—Ç—å 2 –¥–∞—Ç–∞—Ñ—Ä–∞–π–º–∞ ‚Äî —Å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏.
#     
# –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è —Ç–∞–∫–æ–≥–æ —Å–ª—É—á–∞—è:
# 
#     encoder = OneHotEncoder(handle_unknown='ignore', drop='first')
# 
#     features_train_ohe = pd.DataFrame(
#         encoder.fit_transform(features_train[var_categorical]).toarray(),
#         columns=encoder.get_feature_names_out()
#     )
#     
#     scaler = StandardScaler()
# 
#     features_train_numeric = pd.DataFrame(
#         scaler.fit_transform(features_train[var_numeric]),
#         columns=var_numeric
#     )
#     
#     features_train_enc = features_train_ohe.join(features_train_numeric)
#     
# –í —ç—Ç–æ–º –±–ª–æ–∫–Ω–æ—Ç–µ –ø–æ–∫–∞–∑–∞–Ω –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é OHE, –∞ —Ç–∞–∫–∂–µ –µ—Å—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è make_column_transformer –∏ make_pipeline —Å –ø—Ä–∏–º–µ—Ä–æ–º. 
#     
# https://colab.research.google.com/drive/1_gAMXcQKoCShB_l8FNtYEejMnosm9mvt?usp=sharing
# </div>

# In[6]:


features_train = pd.get_dummies(features_train, drop_first=True)
features_valid = pd.get_dummies(features_valid, drop_first=True)
features_test = pd.get_dummies(features_test, drop_first=True)
display('–°—Ç–æ–ª–±—Ü—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è  –î–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ features_train', features_train.info())
display('–°—Ç–æ–ª–±—Ü—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è –î–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ features_valid', features_valid.info())
display('–°—Ç–æ–ª–±—Ü—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è  –î–∞—Ç–∞—Ñ—Ä–µ–π–º–∞ features_test', features_test.info())


# –ü—Ä–∏–≤–æ–¥–∏–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫ –µ–¥–∏–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±—É, –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Å—Ç–µ–º–∞, –º–æ–∂–µ—Ç –≤–æ—Å–ø—Ä–∏–Ω—è—Ç—å –∫–∞–∫–æ–µ-–ª–∏–±–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π –±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–º, –Ω–µ–∂–µ–ª–∏ –¥—Ä—É–≥–∏–µ

# In[7]:


pd.options.mode.chained_assignment = None

numeric = ['CreditScore', 'Balance', 'Age', 'Tenure', 'EstimatedSalary' ]

scaler = StandardScaler()
scaler.fit(features_train[numeric]) 

features_train[numeric] = scaler.transform(features_train[numeric])
features_valid[numeric] = scaler.transform(features_valid[numeric])

features_train


# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå:</b> –ù–µ –∑–∞–±—ã–≤–∞–π –¥–µ–ª–∞—Ç—å transform –Ω–∞ –≤—Å–µ –≤—ã–±–æ—Ä–∫–∏. –ü—Ä–æ–ø—É—Å—Ç–∏–ª —Ç–µ—Å—Ç–æ–≤—É—é.
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞:</b> –°–ø–∞—Å–∏–±–æ, –ø—Ä–æ–ø—É—Å—Ç–∏–ª —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç. –ò—Å–ø—Ä–∞–≤–∞–∏–ª –Ω–∏–∂–µ </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è:</b> üëç
# </div>

# In[8]:


features_test[numeric] = scaler.transform(features_test[numeric])


# –í–û–ü–†–û–° –†–ï–í–¨–Æ–≠–†–£- –ù–∞—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏ –Ω–∞–º –≤–∞–∂–Ω—ã —Å—Ç—Ä–æ–∫–∏ —Å —Ñ–∞–º–∏–ª–∏–µ–π, –ø–æ—Ä—è–¥–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º –∏ CustomerId –∏–ª–∏ –∏—Ö –º–æ–∂–Ω–æ –≤—ã–∫–∏–Ω—É—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏, —á—Ç–æ–±—ã –Ω–µ —Å–º—É—â–∞—Ç—å –º–æ–¥–µ–ª—å –∏ –Ω–µ –∑–∞—Ç—Ä—É–¥–Ω—è—Ç—å –µ–π —Ä–∞–±–æ—Ç—É, –∞ —Ç–∞–∫–∂–µ –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–µ–π –Ω–∞ —ç—Ç–æ —ç—Ç–∞–ø–µ –∏–ª–∏ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –Ω–∞–º –ø–æ–∑–∂–µ?

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è:</b> –≠—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ –Ω–µ—Å—É—Ç, –æ–Ω–∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –¥–∞–Ω–Ω—ã–º). –ï—Å–ª–∏ –≤–∫–ª—é—á–∞—Ç—å —ç—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤ –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –Ω–∞–π—Ç–∏ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏ —Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã —Å –∏—Ö —É—á—ë—Ç–æ–º, –∫–æ–≥–¥–∞ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–µ–π –Ω–µ—Ç, —ç—Ç–æ –±—É–¥–µ—Ç –∑–∞–º–µ–¥–ª—è—Ç—å —Ä–∞–±–æ—Ç—É –∏ —É—Ö—É–¥—à–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏. –ù–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
# </div>

# ## –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏

# –ò—Å—Å–ª–µ–¥—É–µ–º –±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å–∫–æ–ª—å–∫–æ 0 –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—Ç –Ω–∞–¥ 1 –≤ –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ

# In[9]:


target_zeros = target[target == 0]
target_ones = target[target == 1]
print(target_zeros.shape)
target_ones.shape


# –†–∞–∑–Ω–∏—Ü–∞ –¥–æ–≤–æ–ª—å–Ω–æ –æ—â—É—Ç–∏–º–∞, –¥–∏—Å–±–∞–ª–∞–Ω—Å –Ω–∞ –ª–∏—Ü–æ
# –û–¥–Ω–∞–∫–æ, —Å–ø–µ—Ä–≤–∞ –æ–±—É—á–∏–º —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –±–µ–∑ —É—á–µ—Ç–∞ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤ –∏ —Å—Ä–∞–≤–Ω–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Å —Ä–∞–±–æ—Ç–æ–π –º–æ–¥–µ–ª–∏, –Ω–∞ –±–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

# –°–ø–µ—Ä–≤–∞ –ø—Ä–æ–≤–µ—Ä–∏–º –º–æ–¥–µ–ª—å –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏

# In[10]:


model = LogisticRegression(random_state=12345, solver='liblinear')
model.fit(features_train, target_train) 
predicted_valid = model.predict(features_valid)

probabilities_valid = model.predict_proba(features_valid)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_valid, probabilities_one_valid)


print("F1:", f1_score(target_valid, predicted_valid))
print('AUC-ROC - ', auc_roc)


# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º —Ç–∞–∫–∂–µ –º–æ–¥–µ–ª—å –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –Ω–∞–∏–ª—É—á—à—É—é –º–µ—Ç—Ä–∏–∫—É f1, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–≤ —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≥–ª—É–±–∏–Ω—ã

# In[11]:


best_result = 0
best_depth = 0
best_model = None

for depth in range(1, 20):
   
    model = DecisionTreeClassifier(max_depth=depth, random_state=12345)
    model.fit(features_train, target_train)
    predicted_valid = model.predict(features_valid)
    result = f1_score(target_valid, predicted_valid)
    
    if result > best_result:
        best_result = result
        best_depth = depth
        best_model = model
        
probabilities_valid = best_model.predict_proba(features_valid)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_valid, probabilities_one_valid)        
        
        
print('–õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞-', best_depth, '–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç-', best_result)
print('AUC-ROC - ', auc_roc)


# –§–∏–Ω–∞–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º —Ç–∞–∫–∂–µ –∏ –º–æ–¥–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞, –ø–µ—Ä–µ–±–∏—Ä–∞—è —Ä–∞–∑–Ω—É—é –≥–ª—É–±–∏–Ω—É –∏ –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—à–∞—é—â–∏—Ö –¥–µ—Ä–µ–≤—å–µ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∏–ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

# In[12]:


best_result = 0
best_est = 0
best_depth = 0

for est in range(10, 51, 10):
    for depth in range (1, 30):
        model = RandomForestClassifier(random_state=12345, n_estimators=est, max_depth=depth) 
        model.fit(features_train, target_train)
        predictions_valid = model.predict(features_valid) 
        result = f1_score(target_valid, predictions_valid) 
        if result > best_result:
            best_result = result
            best_est = est
            best_depth = depth
            best_model = model
        
probabilities_valid = best_model.predict_proba(features_valid)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_valid, probabilities_one_valid)  
            
print('–õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞-', best_depth, ', –ª—É—á—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤- ', best_est, '–∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç-', best_result)  
print('AUC-ROC - ', auc_roc)


# –í—ã–≤–æ–¥:
# - –í —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ, –≤ –∫–ª–∞—Å—Å–∞—Ö, –±—ã–ª –≤—ã—è–≤–ª–µ–Ω —Å–∏–ª—å–Ω—ã–π –¥–∏—Å–±–∞–ª–∞–Ω—Å —Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏–π - 0, –Ω–∞–¥ 1 –≤ —Ü–µ–ª–µ–≤–æ–º –ø—Ä–∏–∑–Ω–∞–∫–µ, –ø–æ—á—Ç–∏ –≤–¥–≤–æ–µ
# - –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–ª–∞—Å—Å–∞–º–∏, –º–µ—Ç—Ä–∏–∫—É F1 –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–Ω—è—Ç—å –±–æ–ª–µ–µ 0.5 –Ω–∞ –≤—Å—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø–µ—Ä–µ–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
# - –ù–∞–∏—Ö—É–¥—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ –¥–∞–ª–∞ –º–æ–¥–µ–ª—å –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º f1, —Ä–∞–≤–Ω–æ–º—É 0.3106457242582897, –∞ –Ω–∞–∏–ª—É—á—à–∏–π –¥–µ—Ä–µ–≤–æ —Ä–µ—à–µ–Ω–∏–π, –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≥–ª—É–±–∏–Ω—ã –≤ 9 –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–µ—Ç—Ä–∏–∫–∏ f1 –≤ 0.5843971631205673
# - AUC-ROC —Ä–∞—Å—Ç–µ—Ç –≤–º–µ—Å—Ç–µ —Å F1 –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞–∏–ª–±–æ–ª—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –º–æ–¥–µ–ª–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞
# - –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, —á—Ç–æ —Å–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å, –¥–∞–ª –ø–æ—á—Ç–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –Ω–µ—Å–±–∞–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ, –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥–µ—Ä–µ–≤–æ–º —Ä–µ—à–µ–Ω–∏–π, –æ–¥–Ω–∞–∫–æ –≤ —Ç–æ –∂–µ –≤—Ä–µ–º—è, –º–µ—Ç—Ä–∏–∫–∞ AUC-ROC —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞, –ø–æ–ª—É—á–∏–ª–∞—Å—å –Ω–∞–∏–±–æ–ª—å—à–µ–π, —á—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –¥–µ–ª–∞–µ—Ç –µ–µ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –º–æ–¥–µ–ª—å—é

# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå:</b> ¬´—Å –ø—Ä–µ–æ–±–ª–∞–¥–∞–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏–π - 0, –Ω–∞–¥ 1 –≤ —Ü–µ–ª–µ–≤–æ–º –ø—Ä–∏–∑–Ω–∞–∫–µ, –ø–æ—á—Ç–∏ –≤–¥–≤–æ–µ¬ª ‚Äî –Ω–µ –≤–µ—Ä–Ω–æ, –ø–æ—Å–º–æ—Ç—Ä–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ.
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞: </b> –î–∞, —Ç–µ–ø–µ—Ä—å –≤–∏–∂—É, —á—Ç–æ —Ä–∞–∑–Ω–∏—Ü–∞ –±–æ–ª–µ–µ –æ—â—É—Ç–∏–º–∞, –ø–æ—á—Ç–∏ –≤ 4 —Ä–∞–∑–∞, –∏–º–µ–ª–æ—Å—å –≤ –≤–∏–¥—É —ç—Ç–∞ –æ—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–µ –∏–ª–∏ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ? </div>

# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚ö†Ô∏è: </b> –í—Å–µ –≤—ã–≤–æ–¥—ã –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–¥–µ–ª–µ–π. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–µ—Ç–æ–¥–∞—Ö –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –∫–ª–∞—Å—Å–æ–≤. –ü–∞—Ä–∞–º–µ—Ç—Ä repeat —É —Ç–µ–±—è –±—ã–ª –ø–æ–¥–æ–±—Ä–∞–Ω –≤–µ—Ä–Ω–æ, –∞ fraction ‚Äî –Ω–µ—Ç.
# </div>

# –í–û–ü–†–û–° –†–ï–í–™–Æ–≠–†–£ –ù–µ –¥–æ –∫–æ–Ω—Ü–∞ –ø–æ–Ω–∏–º–∞—é, –ø—Ä–∏–∫–ª–∞–¥–Ω—É—é —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –º–µ—Ç—Ä–∏–∫–∞–º–∏ f1 –∏ AUC-ROC –≤ —á–µ–º –æ–Ω–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è? –ò–º–µ–Ω–Ω–æ —Å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è
# –ö–û–≥–¥–∞ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AUC-ROC, –∞ –∫–æ–≥–¥–∞ F1? –ò —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Å–∏–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø—Ä–∏ —Ç–µ—Å—Ç–µ –º–æ–¥–µ–ª–∏?

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è:</b> F1 —ç—Ç–æ —Å—Ä–µ–¥–Ω–µ–µ –≥–∞—Ä–º–æ–Ω–∏—á–µ—Å–∫–æ–µ –º–µ–∂–¥—É precision –∏ recall, –∞ AUC-ROC ‚Äî –ø–ª–æ—â–∞–¥—å –ø–æ–¥ –∫—Ä–∏–≤–æ–π ROC, –æ–Ω–∞ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç True Positive Rate —Å False Positive Rate. –ß–µ–º –±–æ–ª—å—à–µ AUC-ROC, —Ç–µ–º –±–æ–ª—å—à–µ —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∏—Å—Ç–∏–Ω–Ω–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏ –∏—Å—Ç–∏–Ω–Ω–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏ –∫–ª–∞—Å—Å–∞–º–∏. –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –¥–∏—Å–±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤, –æ—Ü–µ–Ω–∫–∞ AUC-ROC –±—É–¥–µ—Ç –∏—Å–∫–∞–∂–µ–Ω–∞ –∏ –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Å—Ç–æ–∏—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ f1. –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è f1, —Ç.–∫. –æ–Ω–∞ –æ–±–ª–∞–¥–∞–µ—Ç –ª—É—á—à–µ–π –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å—é, –∞ AUC-ROC —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞.
#     
# –°—Ç–∞—Ç—å—è –æ —Ç–æ–º, –∫–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –±—ã–≤–∞—é—Ç –∏ –∫–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
#     
# - https://neptune.ai/blog/evaluation-metrics-binary-classification
# </div>

# ## –ë–æ—Ä—å–±–∞ —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º

# –ß—Ç–æ–±—ã —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º 2 –º–µ—Ç–æ–¥–∞, —É–≤–µ–ª–∏—á–∏–º –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–¥–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤- 1, –∞ —Ç–∞–∫–∂–µ —É–º–µ–Ω—å—à–∏–º –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–æ–≤- 0

# –ò—Å—Å–ª–µ–¥—É–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

# In[13]:


print(features.shape)
print(target.shape)


# –°–ø–µ—Ä–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Ö–Ω–∏–∫—É —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤, —Å–æ –∑–Ω–∞—á–µ–Ω–∏–º- 1 –≤ –≤—ã–±–æ—Ä–∫–µ 

# In[14]:


def upsample(features, target, repeat):
    features_zeros = features[target == 0]
    features_ones = features[target == 1]
    target_zeros = target[target == 0]
    target_ones = target[target == 1]
    
    features_upsampled = pd.concat([features_zeros] + [features_ones] * repeat)
    target_upsampled = pd.concat([target_zeros] + [target_ones] * repeat)
    
    features_upsampled = shuffle(features_upsampled, random_state=12345)
    target_upsampled = shuffle(target_upsampled, random_state=12345)
    
    return features_upsampled, target_upsampled 

features_upsampled, target_upsampled = upsample(features_train, target_train, 4)

print(features_upsampled.shape)
print(target_upsampled.shape)


# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è:</b> –ü–∞—Ä–∞–º–µ—Ç—Ä <code>repeat</code> –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤–µ—Ä–Ω–æ.
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞: </b> –î–æ–±–∞–≤–∏–ª –Ω–∏–∂–Ω, –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ, –∏ –¥–∞–ª–µ–µ —Ç–æ–∂–µ —Å–∞–º–æ–µ, –Ω–æ –Ω–∞ —É–º–µ–Ω—å—à–µ–Ω–Ω–æ–π </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è:</b> –û—Ç–ª–∏—á–Ω–æ! –ü–∞—Ä–∞–º–µ—Ç—Ä repeat –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–æ, –≤–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω–∞–º –Ω–∞–¥–æ —É–≤–µ–ª–∏—á–∏—Ç—å —á–∏—Å–ª–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ–Ω—å—à–µ–≥–æ –∫–ª–∞—Å—Å–∞, —á—Ç–æ–±—ã –∏—Ö —Å—Ç–∞–ª–æ —Å—Ç–æ–ª—å–∫–æ –∂–µ, —Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±–æ–ª—å—à–µ–≥–æ –∫–ª–∞—Å—Å–∞.
# </div>

# In[15]:


target_zeros = target_upsampled[target == 0]
target_ones = target_upsampled[target == 1]
print('–ù—É–ª–µ–π –≤ –Ω–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ- ', target_zeros.shape)
print('–ï–¥–∏–Ω–∏—Ü –≤ –Ω–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ- ', target_ones.shape)


# –û—Ç–ª–∏—á–Ω–æ, repeat –±—ã–ª –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –∫–æ–ª-–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ —Å—Ä–∞–≤–Ω—è–ª–æ—Å—å, —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ–¥–µ–º —Ç–µ—Å—Ç—ã –Ω–∞ –≤—ã–±–æ—Ä–∫–µ —Å —É–≤–µ–ª–∏—á–µ–Ω–æ–π –≤—ã–±–æ—Ä–∫–æ–π, –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ª—É—à—á–µ–π –º–æ–¥–µ–ª–∏.

# 1. –ú–æ–¥–µ–ª—å –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –†–µ–≥—Ä–µ—Å—Å–∏–∏

# In[16]:


model = LogisticRegression(random_state=12345, solver='liblinear')
model.fit(features_upsampled, target_upsampled) 
predicted_valid = model.predict(features_valid)

probabilities_valid = model.predict_proba(features_valid)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_valid, probabilities_one_valid)


print("F1:", f1_score(target_valid, predicted_valid))
print('AUC-ROC - ', auc_roc)


# 2. –ú–æ–¥–µ–ª—å –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π

# In[17]:


best_result = 0
best_depth = 0
best_model = None

for depth in range(1, 30):
   
    model = DecisionTreeClassifier(max_depth=depth, random_state=12345)
    model.fit(features_upsampled, target_upsampled) 
    predicted_valid = model.predict(features_valid)
    result = f1_score(target_valid, predicted_valid)
    
    if result > best_result:
        best_result = result
        best_depth = depth
        best_model = model
        
probabilities_valid = best_model.predict_proba(features_valid)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_valid, probabilities_one_valid)        
        
        
print('–õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞-', best_depth, '–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç-', best_result)
print('AUC-ROC - ', auc_roc)


# 3. –ú–æ–¥–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞

# In[18]:


best_model = None
best_result = 0
best_est = 0
best_depth = 0

for est in range(10, 80, 10):
    for depth in range (1, 30):
        model = RandomForestClassifier(random_state=12345, n_estimators=est, max_depth=depth) 
        model.fit(features_upsampled, target_upsampled)  
        predictions_valid = model.predict(features_valid)
        result = f1_score(target_valid, predictions_valid)
        if result > best_result:
            best_model = model
            best_result = result
            best_est = est
            best_depth = depth

        
probabilities_valid = best_model.predict_proba(features_valid)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_valid, probabilities_one_valid)  
            
print('–õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞-', best_depth, ', –ª—É—á—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤- ', best_est, '–∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç-', best_result)  
print('AUC-ROC - ', auc_roc)


# –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –≤—ã–≤–æ–¥:
# –ü–æ –∏—Ç–æ–≥—É –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–∞ –≤—ã–±–æ—Ä–∫–µ, –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –±—ã–ª–∞ —Ä–µ—à–µ–Ω–∞ –∑–∞ —Å—á–µ—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è –≤—ã–±–æ—Ä–∫–∏, –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ–∫–∞–∑–∞–ª–∞ –º–æ–¥–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞, —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º, –º–µ—Ç—Ä–∏–∫–∏ f1 - 0.6446469248291572 –∏ –êUC-ROC -  0.8716837865799585, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∫–∞–∫ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–≤–ª–∏—è–µ—Ç –±–æ—Ä—å–±–∞ —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º —á–µ—Ä–µ–∑ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏

# –ü—Ä–∏–º–µ–Ω–∏–º, —Ç–µ—Ö–Ω–∏–∫—É —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤, —Å —É–º–µ–Ω—å—à–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏—è- 0 –≤ –≤—ã–±–æ—Ä–∫–µ, –¥–ª—è –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º

# In[19]:


def downsample(features, target, fraction):
    features_zeros = features[target == 0]
    features_ones = features[target == 1]
    target_zeros = target[target == 0]
    target_ones = target[target == 1]
    features_downsampled = shuffle(pd.concat(
        [features_zeros.sample(frac=fraction, random_state=12345)] + [features_ones]), random_state=12345)
    target_downsampled = shuffle(pd.concat(
        [target_zeros.sample(frac=fraction, random_state=12345)] + [target_ones]), random_state=12345)
    
   
    return features_downsampled, target_downsampled

features_downsampled, target_downsampled = downsample(features_train, target_train, 0.26)

print(features_downsampled.shape)
print(target_downsampled.shape)


# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå:</b> –í <code>downsample</code> —É–∫–∞–∑—ã–≤–∞–µ—à—å –ø–∞—Ä–∞–º–µ—Ç—Ä <code>fraction</code> —Ä–∞–≤–Ω—ã–π 0.96, —á—Ç–æ –Ω–µ–≤–µ—Ä–Ω–æ. –≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ç–æ, –∫–∞–∫—É—é –¥–æ–ª—é –∫–ª–∞—Å—Å–∞ 0 –º—ã –¥–æ–ª–∂–Ω—ã –≤–∑—è—Ç—å, —á—Ç–æ–±—ã –µ–≥–æ —Å—Ç–∞–ª–æ —Å—Ç–æ–ª—å–∫–æ –∂–µ, —Å–∫–æ–ª—å–∫–æ –∫–ª–∞—Å—Å–∞ 1.
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞: </b> –ü–æ–Ω—è–ª –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –Ω–µ–≤–µ—Ä–Ω–æ –ø–æ–Ω—è–ª –ª–æ–≥–∏–∫—É –ø–æ–¥–±–æ—Ä–∞ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∞. </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è:</b> –ü—Ä–µ–∫—Ä–∞—Å–Ω–æ!üòâ
# </div>

# In[20]:


target_zeros = target_downsampled[target == 0]
target_ones = target_downsampled[target == 1]
print('–ù—É–ª–µ–π –≤ –Ω–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ- ', target_zeros.shape)
print('–ï–¥–∏–Ω–∏—Ü –≤ –Ω–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ- ', target_ones.shape)


# –í–û–ü–†–û–° –†–ï–í–¨–≠–†–£- –ö–∞–∫ –ø–æ–Ω—è—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ –ª—É—á—à–µ —É–≤–µ–ª–∏—á–∏—Ç—å –∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –≤—ã–±–æ—Ä–∫—É, –Ω—É–∂–Ω–æ —á—Ç–æ–±—ã —Ä–∞–∑–º–µ—Ä—ã –≤—ã–±–æ—Ä–∫–∏ –±—ã–ª–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤—ã–Ω –∏–ª–∏ –∂–µ –Ω–µ—Ç?

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚úîÔ∏è:</b> –î–∞, –∫–ª–∞—Å—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–Ω—ã. –ü–æ–Ω—è—Ç—å –Ω–∞ —Å–∫–æ–ª—å–∫–æ –º–æ–∂–Ω–æ –∏–∑ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ –≤ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
# </div>

# –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –ø–∞—Ä–∞–º–µ—Ä—Ç fraction –±—ã–ª –≤—ã–±—Ä–∞–Ω –≤–µ—Ä–Ω–æ, –ø—Ä–æ–≤–µ–¥–µ–º –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞ –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º –∏ —Å—Ä–∞–≤–Ω–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –Ω–∞–∏–ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏.

# 1. –ú–æ–¥–µ–ª—å –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –†–µ–≥—Ä–µ—Å—Å–∏–∏

# In[21]:


model = LogisticRegression(random_state=12345, solver='liblinear')
model.fit(features_downsampled, target_downsampled) 
predicted_valid = model.predict(features_valid)

probabilities_valid = model.predict_proba(features_valid)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_valid, probabilities_one_valid)


print("F1:", f1_score(target_valid, predicted_valid))
print('AUC-ROC - ', auc_roc)


# 2. –ú–æ–¥–µ–ª—å –¥–µ—Ä–µ–≤–∞ —Ä–µ—à–µ–Ω–∏–π

# In[22]:


best_result = 0
best_depth = 0
best_model = None

for depth in range(1, 30):
   
    model = DecisionTreeClassifier(max_depth=depth, random_state=12345)
    model.fit(features_downsampled, target_downsampled) 
    predicted_valid = model.predict(features_valid)
    result = f1_score(target_valid, predicted_valid)
    
    if result > best_result:
        best_result = result
        best_depth = depth
        best_model = model
        
probabilities_valid = best_model.predict_proba(features_valid)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_valid, probabilities_one_valid)        
        
        
print('–õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞-', best_depth, '–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç-', best_result)
print('AUC-ROC - ', auc_roc)


# 3. –ú–æ–¥–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞

# In[23]:


best_model = None
best_result = 0
best_est = 0
best_depth = 0

for est in range(10, 80, 10):
    for depth in range (1, 30):
        model = RandomForestClassifier(random_state=12345, n_estimators=est, max_depth=depth) 
        model.fit(features_downsampled, target_downsampled) 
        predictions_valid = model.predict(features_valid)
        result = f1_score(target_valid, predictions_valid)
        if result > best_result:
            best_model = model
            best_result = result
            best_est = est
            best_depth = depth

        
probabilities_valid = best_model.predict_proba(features_valid)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_valid, probabilities_one_valid)  
            
print('–õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞-', best_depth, ', –ª—É—á—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤- ', best_est, '–∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç-', best_result)  
print('AUC-ROC - ', auc_roc)


# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå:</b> –ù—É–∂–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ö–æ—Ç—è –±—ã 2 —Å–ø–æ—Å–æ–±–∞ —Ä–∞–±–æ—Ç—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏. –° —É–º–µ–Ω—å—à–µ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–æ–π –µ—Å—Ç—å, –∞ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π ‚Äî –Ω–µ—Ç. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–ª–µ–¥—É–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º –∏ –≤—ã–±—Ä–∞—Ç—å –ª—É—á—à—É—é.
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞: </b> –î–æ–±–∞–≤–∏–ª —ç—Ç–æ—Ç —ç—Ç–∞–ø –≤—ã—à–µ, —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–¥–±–æ—Ä–∞ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∏ upsampled. –í—ã–≤–æ–¥ –ø–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –¥–æ–±–∞–≤–ª—è—é –Ω–∏–∂–µ. </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è:</b> üëçüëè
# </div>

# –°—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –Ω–∞ –≤—ã–±–æ—Ä–∫–∞—Ö —Å —É—á–µ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤, –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º:
# 
# –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è:
# –†–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–∏- upsampled: 
# F1: 0.5246753246753246
# AUC-ROC -  0.7938312887969258
# 
# –†–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–∏- downsampled: 
# F1: 0.5286343612334803
# AUC-ROC -  0.792818257956449
# 
# –î–µ—Ä–µ–≤–æ —Ä–µ—à–µ–Ω–∏–π:
# –†–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–∏- upsampled: 
# –õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞- 6 –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç- 0.575925925925926
# AUC-ROC -  0.8234278007685487
# 
# –†–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–∏- downsampled: 
# –õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞- 5 –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç- 0.5900681596884129
# AUC-ROC -  0.8440425165040889
# 
# –°–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å:
# –†–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–∏- upsampled: 
# –õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞- 11 , –ª—É—á—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤-  60 –∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç- 0.6483390607101948
# AUC-ROC -  0.8708277909153612
# 
# –†–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–∏- downsampled: 
# –õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞- 9 , –ª—É—á—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤-  60 –∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç- 0.6333973128598848
# AUC-ROC -  0.8686431544979801
# 

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤, –ø–æ–º–æ–≥–ª–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–Ω—è—Ç—å, —É—Ä–æ–≤–µ–Ω—å –º–µ—Ç—Ä–∏–∫–∞ f1 –∏ AUC-ROC –≤ –æ–±–µ–∏—Ö –º–æ–¥–µ–ª—è—Ö, –ø—Ä–∏ —ç—Ç–æ–º:
# - –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–π –º–æ–¥–µ–ª–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–µ—Ä–µ–±–æ—Ä–∞, –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ downsampled –∏ upsampled –æ—Ç–ª–∏—á–∞–ª–∏—Å—å –≤–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö
# - –ú–µ—Ç—Ä–∏–∫–∞ AUC - ROC –≤–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö —É–≤–µ–ª–∏—á–∏–≤–∞–ª–∞—Å—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∑–Ω–∞—á–µ–Ω–∏—é –º–µ—Ç—Ä–∏–∫–∏ f1
# - –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Ç–∞–∫–∂–µ, —á—Ç–æ –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤, –≤ –Ω–∞–∏–ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫–æ–π upsampled –∏ downsampled, —Ç–∞–∫–∂–µ —Å–æ–≤–ø–∞–¥–∞–ª–æ, –≤ —ç—Ç–æ–π —Å–≤—è–∑–∏, –º–æ–∂–Ω–æ –≤—ã–¥–≤–∏–Ω—É—Ç—å –≥–∏–ø–æ—Ç–µ–∑—É, —á—Ç–æ –Ω–∞–∏–ª—É—á—à–µ–µ –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤ –º–µ–Ω–µ–µ –∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—ã–±–æ—Ä–∫–∏, –Ω–µ–∂–µ–ª–∏ –≥–ª—É–±–∏–Ω–∞
# - –î–µ—Ä–µ–≤–æ —Ä–µ—à–µ–Ω–∏–π –∏ –°–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å, –ø–æ–∫–∞–∑–∞–ª–∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–µ—Å–ª–∏ —Å—É–¥–∏—Ç—å –ø–æ f1 –∏ AUC-ROC) –Ω–∞ –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫–æ–π downsampled, –æ–¥–Ω–∞–∫–æ –Ω–∞–∏–±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π, –ø–æ–∫–∞–∑–∞–ª–∞ –∏–º–µ–Ω–Ω–æ –º–æ–¥–µ–ª—å –°–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞, –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, —Ç–µ—Ö–Ω–∏–∫–æ–π upsampled, –∏–∑ —á–µ–≥–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥, —á—Ç–æ downsampled, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –¥–ª—è –º–æ–¥–µ–ª–µ–π —Å–ª—É—á–∞–π–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞ –∏ –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –∑–∞ —Å—á–µ—Ç —É–º–µ–Ω—å—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∫–∏, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –≤–æ–∑–º–æ–∂–Ω–æ –∑–∞ —Å—á–µ—Ç –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–∞ –≥–∏–ø–∞—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–ª—É—á–∞–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö, —Ç–µ—Ö–Ω–∏–∫–æ–π downsampled
# - –ë—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –æ–±–µ –Ω–∞–∏–ª—É—á—à–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ –≤–µ—Ä—Å–∏–∏ —Ç–µ—Ö–Ω–∏–∫ downsampled –∏ upsampled, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –Ω–µ –±—ã–ª –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ —Å–ª—É—á–∞–π–Ω—ã–º –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å, –ª—É—á—à–∞—è.

# P.S. –í–æ–ø—Ä–æ—Å –≤ –†–µ–≤—å—é—ç—Ä—É, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –Ω–∞–∑—ã–≤–∞—Ç—å —ç—Ç–∏ —Ç–µ—Ö–Ω–∏–∫–∏ –±–æ—Ä—å—é—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º, downsampled –∏ upsampled, –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –Ω–µ—Ç? –ò–ª–∏ –∂–µ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —ç—Ç–∞–ø –∏ –¥–∞–ª–µ–µ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –±–æ—Ä—å—é—ã –≤–º–µ—Å—Ç–æ —ç—Ç–∏—Ö –¥–≤—É—Ö, —É –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥—É—Ç –¥—Ä—É–≥–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è? + –í–æ–ø—Ä–æ—Å —á—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ–µ —è –¥–æ–ª–∂–µ–Ω –±—ã–ª –≤—ã—è–≤–∏—Ç—å –≤ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫–∏ AUC ROC, –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –ø–æ–∫–∞ –ø–æ–Ω–∏–º–∞—é, –∑–∞—á–µ–º –±—ã–ª–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ –µ–µ –∑–Ω–∞—á–µ–Ω–∏–∏

# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚ö†Ô∏è:</b> –î–∞, —Ç–∞–∫ –∏ –Ω–∞–∑—ã–≤–∞—é—Ç, –∏–ª–∏ –ø–æ –¥—Ä—É–≥–æ–º—É ‚Äî –º–µ—Ç–æ–¥ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∏ —É–º–µ–Ω—å—à–µ–Ω–∏—è –≤—ã–±–æ—Ä–∫–∏. –í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ  imblearn –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ <a href="https://imbalanced-learn.org/stable/references/generated/imblearn.over_sampling.SMOTE.html">SMOTE</a> –∏ <a href="https://imbalanced-learn.org/stable/references/generated/imblearn.under_sampling.RandomUnderSampler.html">RandomUnderSampler</a>. –í–º–µ—Å—Ç–æ —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ —Ç—Ä–µ–Ω–∞–∂—ë—Ä–∞, –≤ –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö.
#     
# –§—É–Ω–∫—Ü–∏–∏ –∏–∑ —Ç—Ä–µ–Ω–∞–∂—ë—Ä–∞ –ø–æ–¥—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –ø–µ—Ä–µ–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–µ–ª–∞–µ—Ç—Å—è —Ü–∏–∫–ª–∞–º–∏. –ê –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è, —Ç–æ –¥–ª—è –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã—à–µ. –¢–µ–º–∞ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–ø—Ä–∏–Ω—Ç–µ, —Ç–∞–º –ø–æ–¥—Ä–æ–±–Ω–µ–π –±—É–¥–µ—Ç —Ä–∞—Å—Å–∫–∞–∑–∞–Ω–æ –ø—Ä–æ –µ—ë –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏.
#     
# –ò–¥–µ—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AUC ROC –≤–æ –≤—Å–µ—Ö –º–æ–¥–µ–ª—è—Ö –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–π –º–µ—Ç—Ä–∏–∫–æ–π –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –æ—à–∏–±–æ—á–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º, —Ç.–∫. –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞. –í –ª–æ–≥—Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —ç—Ç–æ —Ö–æ—Ä–æ—à–æ –≤–∏–¥–Ω–æ: –≤ —Å–∞–º–æ–π –ø–µ—Ä–≤–æ–π –º–æ–¥–µ–ª–∏ auc roc –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–ø–ª–æ—Ö–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ f1 –ø—Ä–∏ —ç—Ç–æ–º –æ—á–µ–Ω—å –Ω–∏–∑–∫–∞—è, –µ—Å–ª–∏ –±—ã –º—ã –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ auc roc, –º—ã –±—ã –º–æ–≥–ª–∏ –æ—à–∏–±–æ—á–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å —ç—Ç—É –º–æ–¥–µ–ª—å –∫–∞–∫ —Å–∞–º—É—é –ø—Ä–æ—Å—Ç—É—é –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é. –î–∞–ª–µ–µ –≤–∏–¥–∏–º, —á—Ç–æ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –º–µ—Ç–æ–¥–æ–≤ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏, f1 —Ä–∞—Å—Ç—ë—Ç (–Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã—Å–æ–∫–∞—è), –∞ auc roc –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ. –≠—Ç–æ –Ω–∞–º–µ–∫–∞–µ—Ç –Ω–∞–º –Ω–∞ —Ç–æ, —á—Ç–æ —Ç–∞–∫–æ–π —Ç–∏–ø –º–æ–¥–µ–ª–∏ –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ –ø–ª–æ—Ö–æ –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ. –° –¥–µ—Ä–µ–≤–æ–º –∏ –ª–µ—Å–æ–º –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –¥—Ä—É–≥–∞—è –∫–∞—Ä—Ç–∏–Ω–∞: auc roc –≤–º–µ—Å—Ç–µ —Å f1 –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Ç–æ–¥–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –∏–ª–∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ –æ–±–µ–∏–º –æ—Ü–µ–Ω–∫–∞–º –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞–º –æ —Ö–æ—Ä–æ—à–µ–º –æ–±—É—á–µ–Ω–∏–∏ –º–æ–¥–µ–ª–∏ –∏ –ø—Ä–æ–≥–Ω–æ–∑–∞—Ö.
# </div>

# ## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏

# best_model = None
# best_result = 0
# best_est = 0
# best_depth = 0
# 
# for est in range(10, 80, 10):
#     for depth in range (1, 30):
#         model = RandomForestClassifier(random_state=12345, n_estimators=est, max_depth=depth) 
#         model.fit(features_downsampled, target_downsampled) 
#         predictions_valid = model.predict(features_test)
#         result = f1_score(target_test, predictions_valid)
#         if result > best_result:
#             best_model = model
#             best_result = result
#             best_est = est
#             best_depth = depth
# 
#         
# probabilities_valid = best_model.predict_proba(features_test)
# probabilities_one_valid = probabilities_valid[:, 1]
# 
# auc_roc = roc_auc_score(target_test, probabilities_one_valid)  
#             
# print('–õ—É—á—à–∞—è –≥–ª—É–±–∏–Ω–∞-', best_depth, ', –ª—É—á—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤- ', best_est, '–∏ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç-', best_result)  
# print('AUC-ROC - ', auc_roc)

# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå:</b> –ù–∞ —ç—Ç–∞–ø–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–æ–¥–±–æ—Ä –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –ª—É—á—à–∏–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –ø—Ä–æ—à–ª–æ–º —Ä–∞–∑–¥–µ–ª–µ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö. –Ø—á–µ–π–∫—É —Å–≤–µ—Ä—Ö—É –Ω—É–∂–Ω–æ —É–±—Ä–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É, —á—Ç–æ –Ω–∏–∂–µ.
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞: </b> –ë–ª–∞–≥–æ–¥–∞—Ä—é, –∑–∞–∫–æ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª –¥–∞–Ω–Ω—ã–µ –≤—ã—à–µ. </div>

# model = RandomForestClassifier(random_state=12345, n_estimators= 40, max_depth= 17) 
# model.fit(features_downsampled, target_downsampled) 
# predictions_test = model.predict(features_test)
# result = f1_score(target_test, predictions_valid)
# 
# probabilities_valid = best_model.predict_proba(features_test)
# probabilities_one_valid = probabilities_valid[:, 1]
# 
# auc_roc = roc_auc_score(target_test, probabilities_one_valid) 
# 
# print('–†–µ–∑—É–ª—å—Ç–∞—Ç –º–µ—Ç—Ä–∏–∫–∏ F1-', result)  
# print('AUC-ROC - ', auc_roc)

# <div class="alert alert-danger">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå:</b> –ü—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ <code>result</code> –≤—Ç–æ—Ä—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é <code>predictions_test</code>. –ò –≤–º–µ—Å—Ç–æ <code>best_model</code> –ª—É—á—à–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å <code>model</code>, –∫–æ—Ç–æ—Ä—É—é —Ç—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—à—å –≤ —ç—Ç–æ–π –∂–µ —è—á–µ–π–∫–µ, —Ç–∞–∫ —Ç—ã –∏–∑–±–µ–∂–∏—à—å –æ—à–∏–±–æ–∫ –≤ —Å–ª—É—á–∞–µ –¥—Ä—É–≥–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —è—á–µ–µ–∫, –≥–¥–µ —É —Ç–µ–±—è —Ä–∞—Å—á—ë—Ç best_model.
#     
# –¢–∞–∫–∂–µ –Ω–µ –∑–∞–±—É–¥—å –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ –ø–æ –ø—Ä–æ–µ–∫—Ç—É.
# </div>

# <div class="alert alert-info"> <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—É–¥–µ–Ω—Ç–∞: </b> –ë–ª–∞–≥–æ–¥–∞—Ä—é, –∏—Å–ø—Ä–∞–≤–∏–ª –Ω–∏–∂–µ, –Ω–µ –æ–±—Ä–∞—Ç–∏–ª –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —ç—Ç–æ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑. </div>

# <div class="alert alert-success">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è:</b> –ü—Ä–µ–∫—Ä–∞—Å–Ω–æ! –¢–µ–ø–µ—Ä—å –≤—Å—ë –≤–µ—Ä–Ω–æ üëçüëè
# </div>

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ

# In[24]:


model = RandomForestClassifier(random_state=12345, n_estimators= 60, max_depth= 11) 
model.fit(features_upsampled, target_upsampled) 
predictions_test = model.predict(features_test)
result = f1_score(target_test, predictions_test)

probabilities_valid = model.predict_proba(features_test)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_test, probabilities_one_valid) 

print('–†–µ–∑—É–ª—å—Ç–∞—Ç –º–µ—Ç—Ä–∏–∫–∏ F1-', result)  
print('AUC-ROC - ', auc_roc)


# –ê —Ç–∞–∫–∂–µ, –≤ —Ä–∫–∞–º–∫–∞—Ö —ç–∫—Å–ø—Ä–µ—Ä–∏–º–µ–Ω—Ç–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–∏, –ø–æ–∫–∞–∑–∞–≤—à–µ–π –Ω–∞–∏–±–æ–ª—å—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —Ç–µ—Ö–Ω–∏–∫–∏- downsampled

# In[25]:


model = RandomForestClassifier(random_state=12345, n_estimators= 60, max_depth= 9) 
model.fit(features_downsampled, target_downsampled) 
predictions_test = model.predict(features_test)
result = f1_score(target_test, predictions_test)

probabilities_valid = model.predict_proba(features_test)
probabilities_one_valid = probabilities_valid[:, 1]

auc_roc = roc_auc_score(target_test, probabilities_one_valid) 

print('–†–µ–∑—É–ª—å—Ç–∞—Ç –º–µ—Ç—Ä–∏–∫–∏ F1-', result)  
print('AUC-ROC - ', auc_roc)


# –§–ò–ù–ê–õ–¨–ù–´–ï –í–´–í–û–î–´:
#     - –õ—É—á—à–µ–π –º–æ–¥–µ–ª—å—é –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω–∞ –¥–∞–Ω–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ –æ–∫–∞–∑–∞–ª–æ—Å—å, –º–æ–¥–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ª–µ—Å–∞, –æ–±—É—á–µ–Ω–Ω–∞—è –Ω–∞ –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫–æ–π- upsampled, —Å–æ –∑–∞–Ω—á–µ–Ω–∏–µ–º –º–∞–∫—Å. –≥–ª—É–±–∏–Ω—ã- 11 –∏ –∫–æ–ª-–≤–æ–º –¥–µ—Ä–µ–≤—å–µ–≤- 60
#     - –ó–Ω–∞—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ AUC-ROC, –≤—Å–µ–≥–¥–∞ —Ä–æ—Å–ª–æ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∑–Ω–∞—á–µ–Ω–∏—é –º–µ—Ç—Ä–∏–∫–∏ F1
#     - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞ –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–∏, —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∞–π–Ω–µ –≤–∞–∂–Ω—ã–º —Ñ–∞–∫—Ç–æ—Ä–æ–º –Ω–∞ —Å—Ç–∞–¥–∏–∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –∏ –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ –∏–∑ –≤—ã–±–æ—Ä–∫–∏, –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏, –ø–æ –∏—Ç–æ–≥—É —ç—Ç–æ —Å–∏–ª—å–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–≤—ã—Å–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –µ–µ –æ–±—É—á–µ–Ω–∏—è
#     - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ª—É—á—à–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –ø–æ—Å–ª–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –≤—ã–±–æ—Ä–∫–∏
#     

# –í–û–ü–†–û–° –†–ï–í–¨–≠–†–£
# –ß—Ç–æ–±—ã —è –Ω–∏ –¥–µ–ª–∞–ª, –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ —è –ø–æ–ª—É—á–∞—é –∫—Ä–∞–π–Ω–µ –Ω–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ö–æ—Ç—è –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤—ã–±–æ—Ä–∫–∏ –Ω–∞ —ç—Ç–æ–π –º–æ–¥–µ–ª–∏, –¥–∞–≤–∞–ª–∏ —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —è –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –≤–∏–Ω–æ–π –≤—Å–µ–º—É –∑–¥–µ—Å—å –¥–∏—Å–±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ –∏ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω—É–∂–Ω—É—é –º–µ—Ç—Ä–∏–∫—É, –º–Ω–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∏—Å–±–∞–ª–∞–Ω—Å —Ç–∞–∫–∂–µ –∏ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ –∏–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ –Ω–∞–¥–æ –¥–µ–ª–∞—Ç—å –∏ —Å–º—ã—Å–ª —Ä–∞–±–æ—Ç—ã –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –º–æ—è –º–æ–¥–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏ –Ω–∞ –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ?

# <div class="alert alert-warning">
# <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ö†Ô∏è:</b> –î–∏—Å–±–∞–ª–∞–Ω—Å —É–±–∏—Ä–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –º–æ–≥–ª–∞ –Ω–∞–¥—ë–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ–±–∞ –∫–ª–∞—Å—Å–∞. –í–∏–Ω–æ–π –Ω–∏–∑–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ —Ç–µ—Å—Ç–µ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ —Ç—ã –Ω–µ —Å–¥–µ–ª–∞–ª —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—é —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏, –æ–± —ç—Ç–æ–º –±—ã–ª –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤—ã—à–µ.
# </div>

# In[26]:


target_zeros = target_test[target == 0]
target_ones = target_test[target == 1]
print('–ù—É–ª–µ–π –≤ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ- ', target_zeros.shape)
print('–ï–¥–∏–Ω–∏—Ü –≤ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ- ', target_ones.shape)


# ## –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

# –ü–æ—Å—Ç–∞–≤—å—Ç–µ 'x' –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–∞—Ö. –î–∞–ª–µ–µ –Ω–∞–∂–º–∏—Ç–µ Shift+Enter.

# - [x]  Jupyter Notebook –æ—Ç–∫—Ä—ã—Ç
# - [x]  –í–µ—Å—å –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
# - [x]  –Ø—á–µ–π–∫–∏ —Å –∫–æ–¥–æ–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
# - [x]  –í—ã–ø–æ–ª–Ω–µ–Ω —à–∞–≥ 1: –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã
# - [x]  –í—ã–ø–æ–ª–Ω–µ–Ω —à–∞–≥ 2: –∑–∞–¥–∞—á–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∞
#     - [x]  –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω –±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤
#     - [x]  –ò–∑—É—á–µ–Ω—ã –º–æ–¥–µ–ª–∏ –±–µ–∑ —É—á—ë—Ç–∞ –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞
#     - [x]  –ù–∞–ø–∏—Å–∞–Ω—ã –≤—ã–≤–æ–¥—ã –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
# - [x]  –í—ã–ø–æ–ª–Ω–µ–Ω —à–∞–≥ 3: —É—á—Ç—ë–Ω –¥–∏—Å–±–∞–ª–∞–Ω—Å
#     - [x]  –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º
#     - [x]  –ù–∞–ø–∏—Å–∞–Ω—ã –≤—ã–≤–æ–¥—ã –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
# - [x]  –í—ã–ø–æ–ª–Ω–µ–Ω —à–∞–≥ 4: –ø—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
# - [x]  –£–¥–∞–ª–æ—Å—å –¥–æ—Å—Ç–∏—á—å *F1*-–º–µ—Ä—ã –Ω–µ –º–µ–Ω–µ–µ 0.59
# - [x]  –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∞ –º–µ—Ç—Ä–∏–∫–∞ *AUC-ROC*

# <div class="alert alert-danger">
# <b>–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ ‚ùå:</b> –ë—É–¥—É –∂–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
# <ul>
#     <li>—É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤;</li>
#     <li>–∫–æ–¥–∏—Ä–æ–≤–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤;</li>
#     <li>—Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏;</li>
#     <li>–≤—ã–≤–æ–¥ –ø–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é –±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤;</li>
#     <li>–ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –º–µ—Ç–æ–¥–µ downsample;</li>
#     <li>–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –º–µ—Ç–æ–¥–∞ –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º;</li>
#     <li>–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª–µ –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º;</li>
#     <li>—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏;</li>
#     <li>–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞.</li>
# </ul>
#     
# –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–∏—à–∏!
# </div>

# <div class="alert alert-success">
# <b>–ò—Ç–æ–≥–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Ä–µ–≤—å—é–µ—Ä–∞ v2‚úîÔ∏è:</b> –¢—ã –æ—Ç–ª–∏—á–Ω–æ –ø–æ—Å—Ç–∞—Ä–∞–ª—Å—è! –ì–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –¥–æ–≤–µ—Å—Ç–∏ –º–µ—Ç—Ä–∏–∫—É F1 –¥–æ 0.59 –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ ‚Äî –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞üëç –í—Å–µ –∫—Ä–∞—Å–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏  –ø—Ä–∏—Å–ª—É—à–∞–ª—Å—è –∫ –Ω–µ–±–æ–ª—å—à–∏–º –∑–∞–º–µ—á–∞–Ω–∏—è–º —Ç–æ–∂–µ.
# 
# –†–∞–±–æ—Ç–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è. –ñ–µ–ª–∞—é —Ç–µ–±–µ —É—Å–ø–µ—Ö–æ–≤ –≤ –æ—Å–≤–æ–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ Data Science –∏ —É–¥–∞—á–∏ –≤ –±—É–¥—É—â–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö!üòâ
# </div>
